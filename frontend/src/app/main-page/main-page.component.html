<div class="leftGrid">
  <div class="planList">
    <expl-zs-plan-list
      [plans]="plans()"
      [(selectedPlan)]="selectedPlan" />
  </div>
  <div class="leftBottomGrid">
    @if (this.selectedPlan()) {
      <expl-zs-explainer-select [(selectedExplainer)]="selectedExplainer" />
    }
    <div class="flexColumn">
      @if (this.selectedPlanPrediction(); as prediction) {
        <div class="flexColumnMaxSize">
          <p>
            <span class="boldSpan">Label: </span>
            <span>{{ prediction.label | number: '1.0-2' }}</span>
          </p>
          <p>
            <span class="boldSpan">Prediction: </span>
            <span>{{ prediction.prediction | number: '1.0-2' }}</span>
          </p>
          <p>
            <span class="boldSpan">QError: </span>
            <span>{{ prediction.qerror | number: '1.0-2' }}</span>
          </p>
        </div>
        <mat-divider></mat-divider>
      }
      @if (this.nodeImportancesSorted()) {
        <div class="flexColumn">
          @for (node of this.nodeImportancesSorted(); track node.node.nodeId) {
            @if (node.importance) {
              <p
                aria-hidden="true"
                [class]="['nodeImportanceItem', this.selectedNode() && this.selectedNode()!.nodeId === node.node.nodeId ? 'selected' : '']"
                (click)="selectedNode.set(node.node)"
                (keypress)="selectedNode.set(node.node)">
                <span class="boldSpan">{{ node.node.label }}: </span>
                <span>{{ node.importance | percent }}</span>
                <span class="boldSpan"> = </span>
                <span>{{ node.value | number: '1.0-2' }}</span>
              </p>
            }
          }
        </div>
      }
    </div>
  </div>
</div>
<div class="rightGrid">
  <div class="graphBlock">
    @if (this.selectedFullPlan()) {
      <expl-zs-plan-graph
        [graph]="this.selectedFullPlan()"
        [explanation]="this.selectedPlanExplanation()"
        [(selectedNode)]="selectedNode"></expl-zs-plan-graph>
    }
  </div>
  @if (this.selectedNode(); as selectedNode) {
    <div class="nodeInfo">
      <p>
        <span class="boldSpan">{{ selectedNode.label }}</span>
        @if (this.selectedNodeImportance(); as nodeImportance) {
          <span>: </span>
          <span>{{ nodeImportance.importance | percent }}</span>
          <span class="boldSpan"> = </span>
          <span>{{ nodeImportance.value | number: '1.0-2' }}</span>
        }
      </p>
      <div class="nodeInfoList">
        <table
          mat-table
          [dataSource]="this.selectedNodeInfoFields()">
          <ng-container matColumnDef="attr">
            <th
              mat-header-cell
              *matHeaderCellDef>
              Attribute
            </th>
            <td
              mat-cell
              *matCellDef="let nodeInfo">
              <span class="boldSpan">{{ nodeInfo.name }}</span>
            </td>
          </ng-container>
          <ng-container matColumnDef="value">
            <th
              mat-header-cell
              *matHeaderCellDef>
              Value
            </th>
            <td
              mat-cell
              *matCellDef="let nodeInfo">
              {{ nodeInfo.value }}
            </td>
          </ng-container>
          <ng-container matColumnDef="isFeature">
            <th
              mat-header-cell
              *matHeaderCellDef>
              Is Feature
            </th>
            <td
              mat-cell
              *matCellDef="let nodeInfo">
              {{ nodeInfo.isFeature }}
            </td>
          </ng-container>
          <ng-container matColumnDef="importance">
            <th
              mat-header-cell
              *matHeaderCellDef>
              Importance
            </th>
            <td
              mat-cell
              *matCellDef="let nodeInfo">
              {{ nodeInfo.importance ? (nodeInfo.importance | percent) : '' }}
            </td>
          </ng-container>
          <tr
            mat-header-row
            *matHeaderRowDef="displayedNodeColumns(); sticky: true"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedNodeColumns()"></tr>
        </table>
      </div>
    </div>
  }
</div>
@if (isLoading()) {
  <mat-spinner></mat-spinner>
}
